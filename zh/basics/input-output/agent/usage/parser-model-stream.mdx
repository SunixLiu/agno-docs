---
title: 使用解析模型的流式智能体
---

此示例演示了如何在流式输出中使用解析模型，结合 Claude 进行解析，并使用 OpenAI 进行内容生成。

## 代码

```python parser_model_stream.py
import random
from typing import Iterator, List

from agno.agent import Agent, RunOutputEvent
from agno.models.anthropic import Claude
from agno.models.openai import OpenAIChat
from pydantic import BaseModel, Field
from rich.pretty import pprint  # noqa


class NationalParkAdventure(BaseModel):
    park_name: str = Field(..., description="Name of the national park")
    best_season: str = Field(
        ...,
        description="Optimal time of year to visit this park (e.g., 'Late spring to early fall')",
    )
    signature_attractions: List[str] = Field(
        ...,
        description="Must-see landmarks, viewpoints, or natural features in the park",
    )
    recommended_trails: List[str] = Field(
        ...,
        description="Top hiking trails with difficulty levels (e.g., 'Angel's Landing - Strenuous')",
    )
    wildlife_encounters: List[str] = Field(
        ..., description="Animals visitors are likely to spot, with viewing tips"
    )
    photography_spots: List[str] = Field(
        ...,
        description="Best locations for capturing stunning photos, including sunrise/sunset spots",
    )
    camping_options: List[str] = Field(
        ..., description="Available camping areas, from primitive to RV-friendly sites"
    )
    safety_warnings: List[str] = Field(
        ..., description="Important safety considerations specific to this park"
    )
    hidden_gems: List[str] = Field(
        ..., description="Lesser-known spots or experiences that most visitors miss"
    )
    difficulty_rating: int = Field(
        ...,
        ge=1,
        le=5,
        description="Overall park difficulty for average visitor (1=easy, 5=very challenging)",
    )
    estimated_days: int = Field(
        ...,
        ge=1,
        le=14,
        description="Recommended number of days to properly explore the park",
    )
    special_permits_needed: List[str] = Field(
        default=[],
        description="Any special permits or reservations required for certain activities",
    )


agent = Agent(
    parser_model=Claude(id="claude-sonnet-4-20250514"),
    description="You help people plan amazing national park adventures and provide detailed park guides.",
    output_schema=NationalParkAdventure,
    model=OpenAIChat(id="gpt-5-mini"),
)

# Get the response in a variable
national_parks = [
    "Yellowstone National Park",
    "Yosemite National Park",
    "Grand Canyon National Park",
    "Zion National Park",
    "Grand Teton National Park",
    "Rocky Mountain National Park",
    "Acadia National Park",
    "Mount Rainier National Park",
    "Great Smoky Mountains National Park",
    "Rocky National Park",
]

# Get the response in a variable
run_events: Iterator[RunOutputEvent] = agent.run(
    national_parks[random.randint(0, len(national_parks) - 1)], stream=True
)
for event in run_events:
    pprint(event)
```

## Usage

<Steps>
  <Snippet file="create-venv-step.mdx" />

  <Step title="安装所需的库">
    ```bash
    pip install -U agno pydantic rich
    ```
  </Step>

  <Step title="设置 ANTHROPIC API key">
    <CodeGroup>

    ```bash Mac/Linux
      export ANTHROPIC_API_KEY="your_anthropic_api_key_here"
    ```

    ```bash Windows
      $Env:ANTHROPIC_API_KEY="your_anthropic_api_key_here"
    ```
    </CodeGroup> 
  </Step>

  <Step title="创建一个Python文件">
    Create a Python file and add the above code.
    ```bash
    touch parser_model_stream.py
    ```
  </Step>

  <Step title="运行智能体">
    <CodeGroup>
    ```bash Mac
    python parser_model_stream.py
    ```
    
    ```bash Windows  
    python parser_model_stream.py
    ```
    </CodeGroup>
  </Step>

  <Step title="查找所有Cookbook">
  探索 Agno 仓库中所有可用的Cookbook。点击下方链接，在 GitHub 上查看代码：

    <Link href="https://github.com/agno-agi/agno/tree/main/cookbook/03_agents/input_and_output" target="_blank">
      Agno Cookbooks on GitHub
    </Link>
  </Step>
</Steps>